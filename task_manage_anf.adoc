---
sidebar: sidebar
permalink: task_manage_anf.html
keywords: azure netapp files, create volumes, delete volumes, create nfs volumes, delete nfs volumes, netapp account, capacity pool, create capacity pool, azure netapp files permissions, azure permissions, mount path, get mount path, find mount path, mount volume
summary: Create an Azure NetApp Files working environment in Cloud Manager to create and manage NetApp accounts, capacity pools, volumes, and snapshots.
---

= Setting up Azure NetApp Files and managing volumes
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Create an Azure NetApp Files working environment in Cloud Manager to create and manage NetApp accounts, capacity pools, volumes, and snapshots.

== Creating an Azure AD application

Cloud Manager needs permissions to set up and manage Azure NetApp Files. You can grant the required permissions to an Azure account by creating and setting up an Azure AD application and by obtaining the Azure credentials that Cloud Manager needs.

.Steps

. <<Creating an Azure Active Directory application,Create an Azure Active Directory application>>.

. <<Assigning the application to a role,Assign the application to a role>>.

. <<Getting the application ID and directory ID,Get the application ID and directory ID>>.

. <<Creating a client secret,Create a client secret>>.

=== Creating the AD application

Create an Azure Active Directory (AD) application and service principal that Cloud Manager can use for role-based access control.

.Before you begin

You must have the right permissions in Azure to create an Active Directory application and to assign the application to a role. For details, refer to https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/[Microsoft Azure Documentation: Required permissions^].

.Steps

. From the Azure portal, open the *Azure Active Directory* service.
+
image:screenshot_azure_ad.gif[Shows the Active Directory service in Microsoft Azure.]

. In the menu, click *App registrations*.

. Click *New registration*.

. Specify details about the application:

* *Name*: Enter a name for the application.
* *Account type*: Select an account type (any will work with Cloud Manager).
* *Redirect URI*: Select *Web* and then enter any URLâ€”for example, \https://url

. Click *Register*.

.Result

You've created the AD application.

=== Assigning the app to a role

You must bind the service principal to your Azure subscription and assign it a custom role that has the required permissions.

.Steps

. https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/roles-create-custom[Create a custom role^] that includes the following permissions:
+
[source,json]
"Microsoft.NetApp/netAppAccounts/read",
"Microsoft.NetApp/netAppAccounts/capacityPools/read",
"Microsoft.NetApp/netAppAccounts/capacityPools/volumes/write",
"Microsoft.NetApp/netAppAccounts/capacityPools/volumes/read",
"Microsoft.NetApp/netAppAccounts/capacityPools/volumes/delete,"
"Microsoft.Insights/Metrics/Read"

. Assign the application to the role:

.. From the Azure portal, open the *Subscriptions* service.

.. Select the subscription.

.. Click *Access control (IAM) > Add > Add role assignment*.

.. Select the custom role that you created.

.. Keep *Azure AD user, group, or service principal* selected.

.. Search for the name of the application (you can't find it in the list by scrolling).
+
image:screenshot_azure_service_principal_role.gif[A screenshot that shows the Add role assignment form in the Azure portal.]

.. Select the application and click *Save*.
+
The service principal for Cloud Manager now has the required Azure permissions for that subscription.

=== Getting the app and directory IDs

When you create the Azure NetApp Files working environment in Cloud Manager, you need to provide the application (client) ID and the directory (tenant) ID for the application. Cloud Manager uses the IDs to programmatically sign in.

.Steps

. In the *Azure Active Directory* service, click *App registrations* and select the application.

. Copy the *Application (client) ID* and the *Directory (tenant) ID*.
+
image:screenshot_azure_app_ids.gif[A screenshot that shows the application (client) ID and directory (tenant) ID for an application in Azure Active Directory.]

=== Creating a client secret

You need to create a client secret and then provide Cloud Manager with the value of the secret so Cloud Manager can use it to authenticate with Azure AD.

.Steps

. Open the *Azure Active Directory* service.

. Click *App registrations* and select your application.

. Click *Certificates & secrets > New client secret*.

. Provide a description of the secret and a duration.

. Click *Add*.

. Copy the value of the client secret.
+
image:screenshot_azure_client_secret.gif[A screenshot of the Azure portal that shows a client secret for the Azure AD service principal.]

.Result

Your service principal is now setup and you should have copied the application (client) ID, the directory (tenant) ID, and the value of the client secret. You need to enter this information in Cloud Manager when you add an Azure NetApp Files working environment.

== Creating an Azure NetApp Files working environment

Set up an Azure NetApp Files working environment in Cloud Manager so you can start creating volumes.

. From the Working Environments page, click *Add Working Environment*.

. Select *Microsoft Azure* and then *Azure NetApp Files*.

. Provide details about the client application that you previously set up.
+
* *Working Environment Name*: A name to distinguish this working environment in Cloud Manager.
* *Application (client) ID*: See <<Getting the application ID and directory ID>>.
* *Client Secret*: See <<Creating a client secret>>.
* *Directory (tenant) ID*: See <<Getting the application ID and directory ID>>.

. Click *Add*.

.Result

You should now have an Azure NetApp Files working environment.

image:screenshot_anf_we.gif[]

== Creating volumes

You can create NFS or SMB volumes in a new or existing Azure NetApp Files account.

. Open the Azure NetApp Files working environment.

. Click *Add New Volume*.

. Provide the required information:

* *Azure NetApp Files Account*: Choose an existing Azure NetApp Files account or create a new account.

* *Capacity Pool*: Select an existing capacity pool or create a new capacity pool.
+
info about size and service level

* *Details & Tags*: Enter a volume name and size, the VNet and subnet where the volume should reside, and optionally specify tags for the volume.

* *Protocol*: Choose the NFS or SMB protocol and enter the required information.
+
Here's an example of details for NFS.
+
image:screenshot_anf_nfs.gif[]
+
Here's an example of details for SMB. You'll need to provide Active Directory information when you set up your first SMB volume.
+
image:screenshot_anf_smb.gif[]

. Click *Add Volume*.

== Mounting volumes

Access mounting instructions from within Cloud Manager so you can mount the volume to a host.

. Open the working environment.

. Hover over the volume and click the menu.
+
image:screenshot_anf_volume_menu.gif[A screenshot that shows a volume and the menu that's available in the top right.]

. Select *Mount the volume*.

. Follow the instructions to mount the volume.

== Editing a volume's size and tags

After you create a volume, you can modify its size and tags at any time.

. Open the working environment.

. Hover over the volume and click the menu.
+
image:screenshot_anf_volume_menu.gif[A screenshot that shows a volume and the menu that's available in the top right.]

. Click *Edit*.

. Modify the size and tags as needed.

. Click *Apply*.

== Managing Snapshot copies

Snapshot copies provide a point-in-time copy of your volume. Create Snapshot copies, restore the data to a new volume, and delete Snapshot copies.

.Steps

. Open the working environment.

. Hover over the volume and click the menu.
+
image:screenshot_anf_volume_menu.gif[A screenshot that shows a volume and the menu that's available in the top right.]

. Choose one of the available options to manage Snapshot copies:

* *Create a Snapshot copy*
* *Restore to a new volume*
* *Delete a Snapshot copy*

. Follow the prompts to complete the selected action.

== Deleting volumes

Delete the volumes that you no longer need.

.Steps

. Open the working environment.

. Hover over the volume and click the menu.
+
image:screenshot_anf_volume_menu.gif[A screenshot that shows a volume and the menu that's available in the top right.]

. Click *Delete*.

. Confirm that you want to delete the volume.

== Removing Azure NetApp Files

This action removes Azure NetApp Files from Cloud Manager. It doesn't delete your Azure NetApp Files account or volumes. You can add Azure NetApp Files back to Cloud Manager at any time.

. Open the Azure NetApp Files working environment.

. At the top right of the page, select the actions menu and click *Remove Azure NetApp Files*.
+
image:screenshot_anf_remove.gif[]

. Click *Remove* to confirm.
