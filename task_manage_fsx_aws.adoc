---
sidebar: sidebar
permalink: task_manage_fsx_aws.html
keywords: amazon fsx for ontap, fsx, volumes, create volumes, discover volumes service for fsx, delete volumes, access key, secret key, region, create snapshots
summary: Cloud Manager enables you to create volumes in Amazon FSx for ONTAP. You can also discover  volumes that you have already created from the AWS Management Console and add them to a working environment.
---

= Create an Amazon FSx for ONTAP working environment
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Cloud Manager enables you to create volumes for link:https://www.docs.aws.amazon.com/fsx/latest/ONTAPGuide/what-is-fsx-ontap.html[Amazon FSx for ONTAP]. You can also discover volumes that you have already created from the AWS Management Console and add them to a working environment.

== Create an Amazon FSx for ONTAP working environment

Regardless of whether you have already created volumes from the AWS Management Console, or if you just signed up for Amazon FSx for ONTAP and have no volumes, the first step is to create a working environment for the FSx for ONTAP volumes.

If you already have volumes in FSx for ONTAP, the volumes are automatically added to the new working environment. If you haven't added any volumes yet, you can do that after you create the new working environment.

//TIP: If you have subscriptions and volumes in multiple AWS regions, you need to perform this task for each region.

.Before you begin

Before creating your FSx for ONTAP working environment in Cloud Manager, you will need:

* An AWS access key and secret key with IAM user permissions for FSx for ONTAP or existing FSx for ONTAP credentials created by the AWS IAM administrator.
+
https://docs.aws.amazon.com/general/latest/gr/aws-security-credentials.html[AWS security credentials]
+
https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html[AWS Documentation: Creating a Role to Delegate Permissions to an IAM User^]

* An link:task_setting_up_kms_fsx[active Customer Master Key (CMK) for FSx for ONTAP] configured

* link:task_setting_up_transit_gateway_fsx.html[An AWS transit gateway for FSx for ONTAP] to enable access to the floating IPs from outside the VPC where FSx for ONTAP resides. Floating IP addresses are required for cluster, SVM, and protocol access.

* The AWS region where the FSx for ONTAP instance was created.

.Steps

. In Cloud Manager, add a new Working Environment, select the location *Amazon Web Services*, and click *Next*.

. To create a new FSx for ONTAP environment, select *Amazon FSx for ONTAP* and click *Next*.
+
image:screenshot_add_fsx_working_env.png[A screenshot of adding a working environment for Amazon FSx for ONTAP]
+
TIP: To have Cloud Manager discover an existing FSx for ONTAP environment, click *Click Here* to enter your credentials and select the AWS region and working environment.

. Provide information about your FSx for ONTAP instance:

.. You can select existing FSx for ONTAP credentials or add new credentials to Cloud Manager. To create new credentials, you need to know the AWS access key and secret key
.. Enter the Working Environment name you want to use.
.. Optionally, you can create tags by clicking the plus sign and entering a tag name and value.
.. Enter and confirm the ONTAP Cluster password you want to use.
.. Select the option to use the same password for your SVM user or set a different password.
.. Click *Next*.
+
image:screenshot_add_fsx_credentials.png[A screenshot of adding credentials for FSx for ONTAP]

. Provide region and VPC information:

.. Select a region and VPC with subnets in at least two Availability Zones so each cluster is in a dedicated Availability Zone.
.. Accept the default security group or select a different one.
.. Select an Availability Zone and subnet for each node.
.. Click *Next*.
+
image:screenshot_add_fsx_region.png[A screenshot of adding region and VPC for FSx for ONTAP]

. Enter the range you configured when you link:task_setting_up_transit_gateway_fsx.html[set up an AWS transit gateway^] to enable access to the floating IPs from outside the VPC where FSx for ONTAP resides. Click *Next* to continue.
+
image:screenshot_add_fsx_floatingIP.png[A screenshot of adding region and VPC for FSx for ONTAP]

. Select route tables that include route to the floating IP addresses. If you have just one route table for the subnets in your VPC (the main route table), Cloud Manager automatically adds the floating IP addresses to that route table. Click *Next* to continue.
+
image:screenshot_add_fsx_route_table.png[A screenshot of selecting a route table for FSx for ONTAP]

. Accept the default AWS master key or click *Change Key* to select a different AWS Customer Master Key (CMK). For more information on CMK, see link:https://docs.netapp.com/us-en/occm/task_setting_up_kms.html[Setting up the AWS KMS]. Click *Next* to continue.
+
image:screenshot_add_fsx_encryption.png[A screenshot of setting the default master key for FSx for ONTAP]

. Configure your storage:

.. Select the throughput, capacity, and unit.
.. You can optionally specify an IOPS value. If you don't specify and IOPS value, Cloud Manager will set a default value based on 3 IOPS per Gib of the total capacity entered. For example, if you enter 2000 Gib for the total capacity and no value for the IOPS, the effective IOPS value will be set to 6000.
.. Click *Next*.
+
image:screenshot_add_fsx_storage_config.png[A screenshot of setting storage configuration for FSx for ONTAP]

. Review your configuration:

.. Click the tabs to review your ONTAP properties, provider properties, and networking configuration.
.. Click *Previous* to make changes to any settings.
.. Click *Add* to accept the settings and create your Working Environment.
+
image:screenshot_add_fsx_review.png[A screenshot of reviewing the settings for FSx for ONTAP]

.Result

Cloud Manager displays your FSx for ONTAP configuration on the Canvas page.

image:screenshot_add_fsx_cloud.png[A screenshot of Amazon FSx for ONTAP on the working environments page.]

If volumes already exist, the volumes are automatically added to the new working environment, as shown in the screenshot. You can add additional volumes from Cloud Manager.

If no volumes exist, you can create them now.

// == Create cloud volumes
//
// For configurations where volumes already exist in the Cloud Volumes Service working environment you can use these steps to add new volumes.
//
// For configurations where no volumes exist, you can create your first volume directly from Cloud Manager after you have set up your Cloud Volumes Service for AWS subscription. In the past, the first volume had to be created directly in the Cloud Volumes Service user interface.
//
// .Before you begin
//
// * If you want to use SMB in AWS, you need to set up DNS and Active Directory.
//
// * When planning to create an SMB volume, you need a Windows Active Directory server available to which you can connect. You'll enter this information when creating the volume. Also, make sure the Admin user is able to create a machine account in the Organizational unit (OU) path specified.
//
// * You will need this information when creating the first volume in a new region/working environment:
//
// ** AWS account ID: A 12-digit Amazon account identifier with no dashes. To find your account ID, refer to this link:https://docs.aws.amazon.com/IAM/latest/UserGuide/console_account-alias.html[AWS topic^].
//
// ** Classless Inter-Domain Routing (CIDR) Block: An unused IPv4 CIDR block. The network prefix must range between /16 and /28, and it must also fall within the ranges reserved for private networks (RFC 1918). Do not choose a network that overlaps your VPC CIDR allocations.
//
// .Steps
//
// . Select the new working environment and click *Add New Volume*.
//
// . If you are adding the first volume to the working environment in the region, you have to add AWS networking information.
// .. Enter the IPv4 range (CIDR) for the region.
// .. Enter the 12-digit AWS account ID (with no dashes) to connect your Cloud Volumes account to your AWS account.
// .. Click *Continue*.
// +
// image:screenshot_cvs_aws_network_setup.png[A screenshot of the network setup page where you add the CIDR and AWS account ID]
//
// . The Accepting Virtual Interfaces page describes some steps you will need to perform after you add the volume so that you are prepared to complete that step. Just click *Continue* again.
//
// . In the Details & Tags page, enter details about the volume:
// .. Enter a name for the volume.
// .. Specify a size within the range of 100 GiB to 90,000 GiB (equivalent to 88 TiBs).
// +
// link:reference_cvs_service_levels_and_quotas.html#allocated-capacity[Learn more about allocated capacity^].
// .. Specify a service level: Standard, Premium, or Extreme.
// +
// link:reference_cvs_service_levels_and_quotas.html#service-levels[Learn more about service levels^].
// .. Enter one or more tag names to categorize the volume if you want.
// .. Click *Continue*.
// +
// image:screenshot_cvs_vol_details_page.png[A screenshot of the volume details page where you supply the name, size, and service level]
//
// . In the Protocol page, select NFS, SMB, or Dual Protocol and then define the details. Required entries for NFS and SMB are shown in separate sections below.
// . In the Volume Path field, specify the name of the volume export you will see when you mount the volume.
// . If you select Dual-protocol you can select the security style by selecting NTFS or UNIX. Security styles affect the file permission type used and how permissions can be modified.
// * UNIX uses NFSv3 mode bits, and only NFS clients can modify permissions.
// * NTFS uses NTFS ACLs, and only SMB clients can modify permissions.
//
// . For NFS:
// .. In the NFS Version field, select NFSv3, NFSv4.1, or both depending on your requirements.
// .. Optionally, you can create an export policy to identify the clients that can access the volume. Specify the:
// * Allowed clients by using an IP address or Classless Inter-Domain Routing (CIDR).
// * Access rights as Read & Write or Read Only.
// * Access protocol (or protocols if the volume allows both NFSv3 and NFSv4.1 access) used for users.
// * Click *+ Add Export Policy Rule* if you want to define additional export policy rules.
// +
// The following image shows the Volume page filled out for the NFS protocol:
// +
// image:screenshot_cvs_nfs_details.png[A screenshot that shows the volume page filled out for an NFS Cloud Volumes Service volume.]
//
// . For SMB:
// .. You can enable SMB session encryption by checking the box for SMB Protocol Encryption.
// .. You can integrate the volume with an existing Windows Active Directory server by completing the fields in the Active directory section:
// +
// [cols=2*,options="header",cols="25,75"]
// |===
// | Field
// | Description
//
// | DNS Primary IP Address | The IP addresses of the DNS servers that provide name resolution for the SMB server. Use a comma to separate the IP addresses when referencing multiple servers, for example, 172.31.25.223, 172.31.2.74..
//
// | Active Directory Domain to join | The FQDN of the Active Directory (AD) domain that you want the SMB server to join.
// When using AWS Managed Microsoft AD, use the value from the "Directory DNS name" field.
//
// | SMB Server NetBIOS name | A NetBIOS name for the SMB server that will be created.
//
// | Credentials authorized to join the domain | The name and password of a Windows account with sufficient privileges to add computers to the specified Organizational Unit (OU) within the AD domain.
//
// | Organizational Unit | The organizational unit within the AD domain to associate with the SMB server. The default is CN=Computers for connections to your own Windows Active Directory server.
// If you configure AWS Managed Microsoft AD as the AD server for the Cloud Volumes Service, you should enter *OU=Computers,OU=corp* in this field.
// |===
// +
// The following image shows the Volume page filled out for the SMB protocol:
// +
// image:screenshot_cvs_smb_details.png[A screenshot that shows the volume page filled out for an SMB Cloud Volumes Service volume.]
// +
// TIP: You should follow the guidance on AWS security group settings to enable cloud volumes to integrate with Windows Active Directory servers correctly. See link:reference_security_groups_windows_ad_servers.html[AWS security group settings for Windows AD servers^] for more information.
//
// . In the Volume from Snapshot page, if you want this volume to be created based on a snapshot of an existing volume, select the snapshot from the Snapshot Name drop-down list.
//
// . In the Snapshot Policy page, you can enable Cloud Volumes Service to create snapshot copies of your volumes based on a schedule. You can do this now or edit the volume later to define the snapshot policy.
// +
// See link:task_manage_cloud_volumes_snapshots.html#create_or_modify_a_snapshot_policy[Creating a snapshot policy^] for more information about snapshot functionality.
//
// . Click *Add Volume*.
//
// The new volume is added to the working environment.
//
// .After you finish
//
// If this is the first volume created in this AWS subscription, you need to launch the AWS Management Console to accept the two virtual interface that will be used in this AWS region to connect all your cloud volumes. See the https://docs.netapp.com/us-en/cloud_volumes/aws/media/cvs_aws_account_setup.pdf[NetApp Cloud Volumes Service for AWS Account Setup Guide^] for details.
//
// You must accept the interfaces within 10 minutes after clicking the *Add Volume* button or the system may time out. If this happens, email cvs-support@netapp.com with your AWS Customer ID and NetApp Serial Number. Support will fix the issue and you can restart the onboarding process.
//
// Then continue with link:task_manage_cvs_aws.html#mount-the-cloud-volume[Mounting the cloud volume].
//
// == Mount the cloud volume
//
// You can mount a cloud volume to your AWS instance. Cloud volumes currently support NFSv3 and NFSv4.1 for Linux and UNIX clients, and SMB 3.0 and 3.1.1 for Windows clients.
//
// *Note:* Please use the highlighted protocol/dialect supported by your client.
//
// .Steps
// . Open the working environment.
// . Hover over the volume and click *Mount the volume*.
// +
// NFS and SMB volumes display mount instructions for that protocol. Dual-protocol volumes provide both sets of instructions.
// . Hover over the commands and copy them to your clipboard to make this process easier. Just add the destination directory/mount point at the end of the command.
// +
// *NFS example:*
// +
// image:screenshot_cvs_aws_nfs_mount.png[Mount instructions for NFS volumes]
// +
// The maximum I/O size defined by the `rsize` and `wsize` options is 1048576, however 65536 is the recommended default for most use cases.
// +
// Note that Linux clients will default to NFSv4.1 unless the version is specified with the `vers=<nfs_version>` option.
// +
// *SMB example:*
// +
// image:screenshot_cvs_aws_smb_mount.png[Mount instructions for SMB volumes]
// . Connect to your Amazon Elastic Compute Cloud (EC2) instance by using an SSH or RDP client, and then follow the mount instructions for your instance.
// +
// After completing the steps in the mount instructions, you have successfully mounted the cloud volume to your AWS instance.
//
// == Managing existing volumes
//
// You can manage existing volumes as your storage needs change. You can view, edit, restore, and delete volumes.
//
// .Steps
//
// . Open the working environment.
// . Hover over the volume.
// +
// image:screenshot_cvs_aws_volume_hover_menu.png[A screenshot of the volume hover menu that allows you to perform volume tasks]
// . Manage your volumes:
// +
// [cols=2*,options="header",cols="30,70"]
// |===
//
// | Task
// | Action
//
// | View information about a volume | Select a volume, and then click *Info*.
//
// | Edit a volume (including snapshot policy)
// a|
// .. Select a volume, and then click *Edit*.
// .. Modify the volume's properties and then click *Update*.
//
// | Get the NFS or SMB mount command
// a|
// .. Select a volume, and then click *Mount the volume*.
// .. Click *Copy* to copy the command(s).
//
// | Create a Snapshot copy on demand
// a|
// .. Select a volume, and then click *Create a Snapshot copy*.
// .. Change the snapshot name, if needed, and then click *Create*.
//
// | Replace the volume with the contents of a Snapshot copy
// a|
// .. Select a volume, and then click *Revert volume to Snapshot*.
// .. Select a Snapshot copy and click *Revert*.
//
// | Delete a Snapshot copy
// a|
// .. Select a volume, and then click *Delete a Snapshot copy*.
// .. Select the Snapshot copy you want to delete and click *Delete*.
// .. Click *Delete* again to confirm.
//
// | Delete a volume
// a|
// .. Unmount the volume from all clients:
// * On Linux clients, use the `umount` command.
// * On Windows clients, click *Disconnect network drive*.
// .. Select a volume, and then click *Delete*.
// .. Click *Delete* again to confirm.
//
// |===
//
// == Remove Cloud Volumes Service from Cloud Manager
//
// You can remove a Cloud Volumes Service for AWS subscription and all existing volumes from Cloud Manager. The volumes are not deleted, they are just removed from the Cloud Manager interface.
//
// .Steps
// . Open the working environment.
// +
// image:screenshot_cvs_aws_remove.png[A screenshot of selecting the option to remove the Cloud Volumes Service from Cloud Manager.]
// . Click the image:screenshot_gallery_options.gif[] button at the top of the page and click *Remove Cloud Volumes Service*.
// . In the confirmation dialog box, click *Remove*.
//
// == Manage Active Directory configuration
//
// If you change your DNS servers or Active Directory domain, you need to modify the SMB server in Cloud Volumes Services so that it can continue to serve storage to clients.
//
// You can also delete the link to an Active Directory if you no longer need it.
//
// .Steps
// . Open the working environment.
// . Click the image:screenshot_gallery_options.gif[] button at the top of the page and click *Manage Active Directory*.
// . If no Active Directory is configured, you can add one now. If one is configured, you can modify the settings or delete it using the image:screenshot_gallery_options.gif[] button.
// . Specify the settings for the Active Directory that you want to join:
// +
// [cols=2*,options="header",cols="25,75"]
// |===
// | Field
// | Description
//
// | DNS Primary IP Address | The IP addresses of the DNS servers that provide name resolution for the SMB server. Use a comma to separate the IP addresses when referencing multiple servers, for example, 172.31.25.223, 172.31.2.74.
//
// | Active Directory Domain to join | The FQDN of the Active Directory (AD) domain that you want the SMB server to join.
// When using AWS Managed Microsoft AD, use the value from the "Directory DNS name" field.
//
// | SMB Server NetBIOS name | A NetBIOS name for the SMB server that will be created.
//
// | Credentials authorized to join the domain | The name and password of a Windows account with sufficient privileges to add computers to the specified Organizational Unit (OU) within the AD domain.
//
// | Organizational Unit | The organizational unit within the AD domain to associate with the SMB server. The default is CN=Computers for connections to your own Windows Active Directory server.
// If you configure AWS Managed Microsoft AD as the AD server for the Cloud Volumes Service, you should enter *OU=Computers,OU=corp* in this field.
// |===
// . Click *Save* to save your settings.
